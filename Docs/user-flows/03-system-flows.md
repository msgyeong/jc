# 시스템/공통 유저 플로우

생성일: 2026-01-19

본 문서는 **앱과 관리자 웹에서 공통으로 사용되는 플로우**를 정의한다.

- 기준 문서: `../prd/08-design.md`, `../prd/04-non-functional.md`
- 관련 플로우: `01-app-flows.md`, `02-admin-web-flows.md`

---

## UF-SYS-001 로그인/로그아웃 (앱)

### 플로우 개요
앱에서 사용자가 로그인하고 로그아웃하는 과정

### 진입 경로
스플래시 → 로그인 화면 (필요 시)

### 관련 화면
- (앱) 로그인 화면

### 관련 기능
- F-AUTH (인증 시스템)

### 단계별 흐름

#### 로그인
1. 앱 실행 시 인증 상태 확인
2. 미인증 사용자: 로그인 화면으로 이동
3. 이메일 입력
4. 비밀번호 입력
5. 로그인 버튼 선택
6. 인증 확인
   - 성공: 홈 화면으로 이동
   - 실패: 오류 메시지 표시 (입력값 유지)

#### 로그아웃
1. 내 프로필 화면에서 로그아웃 버튼 선택
2. Supabase 세션 해제
3. 로컬 저장된 로그인 상태 삭제
4. 로그인 화면으로 이동

### 로그인 상태 관리
- 자동 로그인 유지: 한번 로그인하면 해당 기기에서 계속 로그인 상태 유지
- 앱 삭제 또는 명시적 로그아웃 시에만 로그인 상태 해제
- 핸드폰 변경 시에만 다시 로그인 필요

### 로그인 에러 처리
- 미등록 이메일: "등록되지 않은 회원입니다" 메시지 표시
- 비밀번호 불일치: "비밀번호가 일치하지 않습니다" 메시지 표시 (정중한 톤)

### 회원 상태별 로그인 처리
- 가입대기 상태 (`is_approved = false`, `rejection_reason IS NULL`): 승인 진행중 화면으로 리다이렉트
- 거절 상태 (`is_approved = false`, `rejection_reason IS NOT NULL`): 로그인 차단, 거절 사유 안내
- 정지 상태 (`is_suspended = true`): 로그인 차단, 정지 안내
- 탈퇴 상태 (`withdrawn_at IS NOT NULL` 또는 `is_deleted = true`): 로그인 차단

---

## UF-SYS-002 로그인/로그아웃 (관리자 웹)

### 플로우 개요
관리자 웹에서 최고 관리자가 로그인하고 로그아웃하는 과정

### 진입 경로
관리자 웹 진입 → 로그인 화면

### 관련 화면
- (관리자 웹) AW-001 (관리자 웹 로그인)

### 관련 기능
- (관리자 웹) 인증

### 단계별 흐름

#### 로그인
1. 관리자 웹 접근 시 인증 상태 확인
2. 미인증 사용자: 로그인 화면으로 이동
3. 아이디 입력 (`manager_###`)
4. 비밀번호 입력
5. 로그인 버튼 선택
6. 인증 확인
   - 성공: AW-002 (가입 승인 목록)로 이동
   - 실패: 오류 표시 후 입력 유지

#### 로그아웃
1. 관리자 웹에서 로그아웃 버튼 선택
2. 세션 해제
3. 로그인 화면으로 이동

### 인증 정책
- 최고 관리자 계정(`manager_###`)만 접근 가능
- 인증되지 않은 사용자는 모든 관리자 웹 화면 접근 차단

---

## UF-SYS-003 회원 가입

### 플로우 개요
새로운 사용자가 회원 가입을 신청하는 과정

### 진입 경로
로그인 화면 → 회원가입 화면

### 관련 화면
- (앱) 회원가입 화면

### 관련 기능
- F-AUTH (인증 시스템)

### 단계별 흐름
1. 로그인 화면에서 "회원가입" 버튼 선택
2. 회원가입 화면 진입
3. 로그인 정보 입력
   - E-mail (필수)
   - 비밀번호 8자리 (필수)
   - 비밀번호 확인 8자리 (필수)
4. 기본 정보 입력
   - 프로필 사진 업로드 (1매 필수, 500mb 이하)
   - 성명 (한글 필수, 한자/영문 선택)
   - 주민등록번호 (하이픈 포함, 필수)
   - 자택 주소 (상세 주소 포함, 필수)
   - 휴대폰 (하이픈 포함, 필수)
5. 직장 정보 입력 (선택)
   - 직장명, 직위, 직장 주소, 직종
6. 학력 정보 입력 (최소 1개 이상)
   - 졸업 년월 (6자리)
   - 학교명
7. 경력 정보 입력 (최소 1개 이상)
   - 경력 년월 (6자리)
   - 경력사항
8. 가족 정보 입력
   - 혼인 유무 (필수)
   - 혼인인 경우: 배우자명, 배우자 연락처, 배우자 생년월일 (필수)
   - 자녀 유무 (필수)
   - 자녀 있는 경우: 자녀 이름 (자녀별 추가 입력)
9. 기타 정보 입력 (선택)
   - 취미, 특기, 추천인
10. 개인정보 보호 동의 체크박스 선택 (필수)
11. "가입 승인" 버튼 선택
12. 회원가입 정보 저장 (`is_approved = false`)
13. "회원 가입이 승인 진행중입니다" 화면 표시
14. "확인" 버튼 클릭 → 로그인 화면으로 복귀

### 비정상 흐름
- 필수 입력 미완료: 가입 승인 버튼 비활성화
- 이메일 중복: 인라인 오류 메시지 표시
- 비밀번호 불일치: 인라인 오류 메시지 표시
- 네트워크 오류: 재시도 버튼 제공, 입력값 유지

### 가입 승인 후
- 관리자 웹에서 가입 승인 처리 (`is_approved = true`) 필요
- 승인 후 로그인 및 서비스 이용 가능

---

## UF-SYS-004 에러 처리

### 플로우 개요
앱과 관리자 웹에서 발생하는 다양한 에러 상황에 대한 처리

### 에러 유형

#### 네트워크 에러
- 원인: 서버 연결 실패, 타임아웃 등
- 처리: 재시도 버튼 제공, 입력값 유지 (작성 중인 데이터 손실 방지)

#### 권한 에러
- 원인: 접근 권한 없음, 로그인 필요 등
- 처리: 접근 차단, 권한 안내 메시지 표시

#### 인증 에러
- 원인: 로그인 실패, 세션 만료 등
- 처리: 로그인 화면으로 리다이렉트

#### 유효성 검사 에러
- 원인: 입력값 형식 오류, 필수 항목 미입력 등
- 처리: 해당 항목 하단에 인라인 오류 메시지 표시 (스낵바 대신)

#### 서버 에러
- 원인: 서버 내부 오류, 데이터베이스 오류 등
- 처리: 오류 메시지 표시, 재시도 제공

### 에러 처리 원칙
- 오류 메시지는 정중하고 명확하게 표시
- 사용자가 입력한 올바른 정보는 유지 (재입력 최소화)
- 복구 가능한 오류는 재시도 제공
- 치명적 오류는 적절한 안내 후 안전한 화면으로 이동

---

## UF-SYS-005 공통 네비게이션

### 플로우 개요
앱에서 공통으로 사용되는 네비게이션 패턴

### 하단 탭 네비게이션 (앱)
- 홈 (S-001)
- 게시판 (S-002)
- 일정 (S-007)
- 회원 (S-009)
- 내 프로필 (S-011)

### 네비게이션 규칙
- 로그인하지 않은 사용자는 하단 탭 네비게이션 숨김
- 모든 보호된 화면 접근 차단
- 로그인 화면으로 자동 리다이렉트

### 뒤로 가기
- 일반 화면: 이전 화면으로 복귀 (스크롤 위치 유지)
- 상세 화면: 목록 화면으로 복귀 (검색 조건 유지)

---

## UF-SYS-006 데이터 동기화

### 플로우 개요
앱과 관리자 웹 간 데이터 동기화

### 동기화 지점

#### 관리자 웹 → 앱
- 회원 정보 수정 → 앱 프로필에 즉시 반영
- 공지사항 작성 → 앱 홈/공지 목록에 즉시 반영
- 일정 등록 → 앱 홈/일정 목록에 즉시 반영
- 권한 변경 → 앱에서 즉시 반영

#### 앱 → 앱
- 게시글 작성 → 목록에 즉시 반영
- 댓글 작성 → 상세 화면에 즉시 반영
- 공감 → 실시간 반영
- 읽음 상태 → 다른 기기에서도 동기화

### 동기화 방식
- Supabase 실시간 기능 활용 (가능한 경우)
- 또는 앱 화면 진입 시 최신 데이터 조회

---

## 참고 문서

- 앱 플로우: `01-app-flows.md`
- 관리자 웹 플로우: `02-admin-web-flows.md`
- 기능 상세 설계: `../prd/08-design.md`
- 비기능 요구사항: `../prd/04-non-functional.md`
